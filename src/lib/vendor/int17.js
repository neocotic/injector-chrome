/*! int17 v0.2.1 | (c) 2013 Alasdair Mercer | MIT License
*/(function(){"use strict";function e(e){return q.call(e).toLowerCase().slice(8,-1)}function t(t,n){var r=C.call(arguments,2);if("function"===e(n))n.apply(t,r);else if(r[0])throw r[0]}function n(e){return e?(""+e).replace(T,function(e){return b[e]}):""}function r(e,t){var n,r,s=[];for(n=0;t.length>n;n++)r=t[n].match(S),r&&r[1]===e&&s.push(t[n]);return s}function s(e,t,n){if(!n)return e[t];t=t.toLowerCase();for(var r in e)if(t===r.toLowerCase())return e[r]}function o(e){var t,n,r=[];for(t=0;k.length>t;t++)n=e.getAttribute(k[t]),r=r.concat(n?n.split(";"):[]);return r}function i(t){return function(n){return"string"===e(n)&&n.length||t}}function a(t,n){return t=t&&t.toLowerCase(),function(r){return e(r)===t||n}}function l(t){return function(n,r){var o=s(t,r.toLowerCase(),!1);return"string"===e(o)?o:n}}function c(e,t){return(t?l:h)(e)}function h(t){return function(n,r){var o=s(t,r.toLowerCase(),!0);return o=o&&o.content,"string"===e(o)?o:n}}function u(t,n,r){var s=t.placeholders,o=t.message||"";return s&&(o=o.replace(x,c(s,n))),r&&r.length&&(o=o.replace(E,function(t,n){return n-=1,"string"===e(r[n])?r[n]:t})),o}function p(t,n){var r="Message["+t+"]";if("object"!==e(n))throw new TypeError(r+" is not an object");if("string"!==e(n.message))throw new TypeError(r+".message is not a string");if(n.hasOwnProperty("placeholders")&&"object"!==e(n.placeholders))throw new TypeError(r+".placeholders is not an object")}function f(t,n,r){var s="Message["+t+"].placeholders["+n+"]";if("object"!==e(r))throw new TypeError(s+" is not an object");if("string"!==e(r.content))throw new TypeError(s+".content is not a string")}function g(e){var t=[];e=C.call(e);for(var n=0;e.length>n;n++)t=t.concat(e[n]);return t}function y(e){this.int17=e,this.configure()}function v(){function e(e){n.escape[e]=function(){var t,r=n.escaping;n.escaping=!0;try{t=n[e].apply(n,C.call(arguments))}finally{r||delete n.escaping}return t}}this.messenger=new y(this),this.node=A.document;var t,n=this;for(this.escape={},t=0;L.length>t;t++)e(L[t])}function m(){this.cache={},this.version="0.2.1"}var d="data-",w="en",b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},L=["all","get","map"],M=this.int17,T=function(){var e=[];for(var t in b)e.push(t);return RegExp("["+e.join("")+"]","g")}(),j=/[\-_]/,S=/^([^\-_]+)[\-_]/,x=/\$(\w+)\$/gi,E=/\$([1-9]\d*)/gi,P=/^([^:]+):(.+)$/,U=/\s/g,k=["int17-subs"];k.push(d+k[0]);var A=this,C=Array.prototype.slice,q=Object.prototype.toString,O={"int17-content":function(e,t){e.innerHTML=this.get(t,o(e))},"int17-options":function(e,t){if(t=t.replace(U,"").split(";")){var n,r,s,i=o(e);for(n=0;t.length>n;n++)r=document.createElement("option"),s=t[n].match(P),s?(r.innerHTML=this.get(s[1],i),r.value=s[2]):r.innerHTML=this.get(t[n],i),e.appendChild(r)}},"int17-values":function(e,t){if(t=t.replace(U,"").split(";")){var n,r,s,i,a,l,c=o(e);for(r=0;t.length>r;r++)if(l=t[r].match(P))if(s=l[1],n=l[2],"."===s[0]){for(a=s.slice(1).split("."),i=e;i&&a.length>1;)i=i[a.shift()];i&&(i[a[0]]=this.get(n,c),~k.indexOf(a[0])?c=o(e):"innerHTML"===a[0]&&this.traverse(e))}else e.setAttribute(s,this.get(n,c)),~k.indexOf(s)&&(c=o(e))}}},H=function(){function e(e){return function(){O[e].apply(this,arguments)}}var t,n,r=[];for(t in O)O.hasOwnProperty(t)&&(n=d+t,O[n]=e(t),r.push(t,n));return r}(),z="["+H.join("],[")+"]";y.prototype.checkMessage=function(t,n){var r,s;this.validate&&p(t,n);for(r in n)if(n.hasOwnProperty(r))switch(s=n[r],r){case"placeholders":"object"===e(s)&&this.checkPlaceholders(t,s);break;case"message":break;default:this.optimize&&delete n[r]}return n},y.prototype.checkMessages=function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.checkMessage(t,e[t]);return e},y.prototype.checkPlaceholders=function(e,t){var n,r,s;for(r in t)t.hasOwnProperty(r)&&(s=t[r],this.validate&&f(e,r,s),this.optimize&&(n=r.toLowerCase(),delete t[r],t[n]=s.content));return t},y.prototype.configure=function(t){return t=t||{},t.locale&&"array"!==e(t.locale)&&(t.locale=t.locale.split(j)),delete this.messages,this.setUp("clean",t,!1,a("boolean")),this.setUp("encoding",t,"UTF-8",i()),this.setUp("extension",t,".json",i()),this.setUp("fallback",t,!1,a("boolean")),this.setUp("fileName",t,"messages",i()),this.setUp("folders",t,!1,a("boolean")),this.setUp("languages",t,[],a("array")),this.setUp("locale",t,null,a("array")),this.setUp("optimize",t,!0,a("boolean")),this.setUp("path",t,"./locales",i()),this.setUp("separator",t,"/",i()),this.setUp("validate",t,!0,a("boolean")),this.languages.sort(),this.reconfigure()},y.prototype.deriveLocale=function(){return this.locale||(this.locale=(this.extractLocale()||w).split(j)),this.locale},y.prototype.extractLocale=function(){var e=document.getElementsByTagName("html")[0];return e&&e.lang?e.lang:navigator.language?navigator.language:void 0},y.prototype.getMessage=function(e){return this.messages[e]},y.prototype.getLocaleFile=function(e){var t=this.getLocaleParent(!0)+this.separator;return t+=this.folders?this.fileName:this.locale.join("_"),t+=this.extension,e?t:this.resolvePath(t)},y.prototype.getLocaleParent=function(e){var t=this.getLocaleRoot(!0);return this.folders&&(t+=this.separator+this.locale.join("_")),e?t:this.resolvePath(t)},y.prototype.getLocaleRoot=function(e){var t=this.path;return e?t:this.resolvePath(t)},y.prototype.loadMessages=function(e,n){try{if(this.messages)return t(this,n,null,this.messages);this.deriveLocale();var r=this,s=new XMLHttpRequest;s.open("GET",this.getLocaleFile(),!0),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status)try{r.messages=r.parseMessages(s.responseText),t(r,n,null,r.messages)}catch(o){t(r,n,o)}else r.fallback&&e&&r.locale.length>1?(r.locale.pop(),r.loadMessages(!1,n)):t(r,n,Error(s.statusText))},s.send(null)}catch(o){t(this,n,o)}},y.prototype.loadMessagesSync=function(e){if(this.messages)return this.messages;this.deriveLocale();var t=new XMLHttpRequest;if(t.open("GET",this.getLocaleFile(),!1),t.send(null),200===t.status)return this.messages=this.parseMessages(t.responseText);if(this.fallback&&e&&this.locale.length>1)return this.locale.pop(),this.loadMessagesSync(!1);throw Error(t.statusText)},y.prototype.parseMessages=function(e){var t=JSON.parse(e);return(this.optimize||this.validate)&&this.checkMessages(t),t},y.prototype.reconfigure=function(){return this},y.prototype.resolvePath=function(e){var t=document.createElement("a");return t.href=e,t.href},y.prototype.setUp=function(e,t,n){for(var r=C.call(arguments,3),s=t[e],o=0;r.length>o;o++)if(!r[o](s)){s=this.hasOwnProperty(e)?this[e]:n;break}this[e]=s},v.prototype.all=function(t){var n,r,s,o=[],i=g(C.call(arguments,1));if(t)for(n=0;t.length>n;n++)r=i,s=t[n],"object"===e(s)&&(r=s.subs||r,s=s.name),o.push(this.get(s,r));return o},v.prototype.attribute=function(e,t,n){if(!this.node)return this;for(var r=g(C.call(arguments,3)),s=this.node.querySelectorAll(e),o=this.get(n,r),i=0;s.length>i;i++)s[i].setAttribute(t,o);return this},v.prototype.content=function(e,t){if(!this.node)return this;for(var n=g(C.call(arguments,2)),r=this.node.querySelectorAll(e),s=this.get(t,n),o=0;r.length>o;o++)r[o].innerHTML=s;return this},v.prototype.get=function(e){if(e){var t=g(C.call(arguments,1)),r=this.messenger.getMessage(e);return r=r&&u(r,this.messenger.optimize,t),this.escaping?n(r):r}},v.prototype.init=function(n,r){"function"===e(n)&&(r=n,n=null);var s=this;try{this.messenger.configure(n).loadMessages(!0,function(e){t(s,r,e)})}catch(o){t(this,r,o)}},v.prototype.initSync=function(e){return this.messenger.configure(e).loadMessagesSync(!0),this},v.prototype.languages=function(n,r){"function"===e(n)&&(r=n,n=null);try{var s=this.languagesSync(n);t(this,r,null,s)}catch(o){t(this,r,o)}},v.prototype.languagesSync=function(e){var t=this.messenger.languages;return e?r(e,this.languagesSync()):(t.length||t.push(this.messenger.locale.join("-")),C.call(t))},v.prototype.locale=function(){return this.messenger.locale.join("-")},v.prototype.map=function(t){var n,r,s,o={},i=g(C.call(arguments,1));if(t)for(n=0;t.length>n;n++)r=i,s=t[n],"object"===e(s)&&(r=s.subs||r,s=s.name),o[s]=this.get(s,r);return o},v.prototype.options=function(t,n){if(!this.node||!n)return this;var r,s,o,i,a,l=this.node.querySelectorAll(t),c=g([].slice.call(arguments,2));for(r=0;l.length>r;r++)for(s=0;n.length>s;s++)o=c,i=n[s],a=document.createElement("option"),"object"===e(i)&&(i.value&&(a.value=i.value),o=i.subs||o,i=i.name),a.innerHTML=this.get(i,o),l[r].appendChild(a);return this},v.prototype.property=function(e,t,n){if(!this.node)return this;var r,s,o,i,a=g(C.call(arguments,3)),l=this.node.querySelectorAll(e),c=this.get(n,a);for(s=0;l.length>s;s++){for(r=l[s],o=r,i=t.split(".");o&&i.length>1;)o=o[i.shift()];o&&(o[i[0]]=c,"innerHTML"===i[0]&&this.traverse(r))}return this},v.prototype.traverse=function(t){if("string"===e(t)&&(t=this.node.querySelector(t)),t=t||this.node,!t)return this;var n,r,s,o,i,a=t.querySelectorAll(z);for(s=0;a.length>s;s++){for(r=a[s],o=0;H.length>o;o++)n=H[o],i=r.getAttribute(n),i&&(O[n].call(this,r,i),this.messenger.clean&&r.removeAttribute(n));if(this.messenger.clean)for(o=0;k.length>o;o++)r.removeAttribute(k[o])}return this},m.prototype.clearCache=function(){return this.cache={},this},m.prototype.create=function(e){return e?this.cache[e]=this.cache[e]||new v:new v},m.prototype.noConflict=function(){return A.int17=M,this};var F=A.define;"object"===e(module)&&module.exports?(require("./node").override(v,y),module.exports=new m):"function"===e(F)&&F.amd?F("int17",function(){return new m}):A.int17=new m}).call(this);